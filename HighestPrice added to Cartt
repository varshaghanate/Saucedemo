
import io.github.bonigarcia.wdm.WebDriverManager;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import org.junit.Assert;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

import java.util.List;

public class LoginScenarioTest {

    private WebDriver d = null;

    @Before
    public void setUp() {
        WebDriverManager.chromedriver().setup();
        d = new ChromeDriver();
        d.manage().window().maximize(); // optional, ensures all buttons are visible
    }

    // ---------- Reusable Login Method ----------
    private void login() {
        d.get("https://www.saucedemo.com");
        d.findElement(By.id("user-name")).sendKeys("standard_user");
        d.findElement(By.id("password")).sendKeys("secret_sauce");
        d.findElement(By.id("login-button")).click();
    }

    // ---------- Method to add highest price item ----------
    private void addHighestPriceItemToCart() {
        // Get all price elements
        List<WebElement> prices = d.findElements(By.className("inventory_item_price"));

        double maxPrice = 0.0;
        WebElement highestPricePriceElement = null;

        // Find the highest price
        for (WebElement priceElement : prices) {
            double price = Double.parseDouble(priceElement.getText().replace("$", ""));
            if (price > maxPrice) {
                maxPrice = price;
                highestPricePriceElement = priceElement;
            }
        }

        // Go to parent container and find the Add to Cart button
        WebElement addToCartButton = highestPricePriceElement.findElement(By.xpath("../button"));
        addToCartButton.click();

        System.out.println("Highest price item added: $" + maxPrice);
    }

    // ---------- Test ----------
    @Test
    public void testAddHighestPriceItemToCart() {
        login(); // Log in first
        addHighestPriceItemToCart(); // Add highest price item

        // Verify cart badge shows 1
        WebElement cartBadge = d.findElement(By.className("shopping_cart_badge"));
        Assert.assertEquals("1", cartBadge.getText());
    }

    @After
    public void cleanUp() {
      if (d != null) {
      d.quit();
    }
    }
}
